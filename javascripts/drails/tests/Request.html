<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>

    <title>PrototypeCompat unit test</title>
    <style type="text/css">
        @import "../../../dojo/resources/dojo.css";
        @import "../css/dijitTests.css";
    </style>

    <!-- required: the default dijit theme: -->
    <link id="themeStyles" rel="stylesheet" href="../../../dijit/themes/tundra/tundra.css">

    <!-- required: dojo.js -->
    <script type="text/javascript" src="/javascripts/dojo/dojo/dojo.js"
        djConfig="isDebug: true, parseOnLoad: true"></script>


    <script type="text/javascript">
        dojo.registerModulePath("drails", "/javascripts/dojo/drails");
        dojo.require("drails.common");
        dojo.require("drails.tests.helpers");
        
        dojo.require("doh.runner");
        dojo.require("drails.tests.ext");
        
        doh.pollute();
        
        spec("drails.Request", function() {
            it("calls the onSuccess callback", function(t){
              var callbackCalled = false;
              var d = new doh.Deferred();
              setTimeout(function() { d.callback(callbackCalled); }, 1000);
              var request = new drails.Request("/success/updater", { onSuccess: function() { callbackCalled = true } });
              return d;
            });

            it("calls the onFailure callback", function(t){
              var callbackCalled = false;
              var d = new doh.Deferred();
              setTimeout(function() { d.callback(callbackCalled); }, 1000);
              var request = new drails.Request("/failure/updater", { onFailure: function() { callbackCalled = true } });
              return d;
            });

            it("fails if passing an unsupported callback", function(t) {
              var error = null;
              try {
                var request = new drails.Request("/success/updater", { onUninitialized: function() { alert("unsupported, this function shouldn't fire!") } });
              }
              catch (e) { error = e; }
              t.is("onUninitialized is not a supported drails operation", error);
            });
            
            it("makes synchronous calls when asynchronous is false", function(t) {
              var called = false
              var request = new drails.Request("/success/updater", { asynchronous: false, onSuccess: function() { called = true } });
              doh.is(called, true);
            })
        });

        dojo.addOnLoad(function(){
            doh.spec.register();
            doh.run();
        });

    </script>
</head>
<body class="tundra">
    
<div id="success_div">success</div>
<div id="failure_div">failure</div>
<div id="updater_div">updater</div>

</body>
</html>
